<Window x:Class="z1.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:z1.Views"
        xmlns:viewModels="clr-namespace:z1.ViewModels"
        xmlns:converters="clr-namespace:z1.Converters"
        Title="Электронный журнал" Height="500" Width="900">

    <Window.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:NullToBooleanConverter x:Key="NullToBooleanConverter"/>

        <DataTemplate x:Key="StudentTemplate">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="{Binding Id}" Width="50" Margin="5"/>
                <TextBox Text="{Binding LastName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                       Width="150" Margin="5"/>
                <TextBlock Text="{Binding Grades.Last.Value}" Width="50" Margin="5"/>
                <TextBox Text="{Binding Grades.Last.Comment, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                       Width="200" Margin="5"/>
                <TextBlock Text="{Binding AverageGrade, StringFormat={}{0:N2}}" Width="80" Margin="5"/>
            </StackPanel>
        </DataTemplate>

        <Style TargetType="Button">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="10,5"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <ProgressBar Grid.Row="0" Height="10" IsIndeterminate="True" 
                   Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"/>

        <Menu Grid.Row="1">
            <MenuItem Header="Файл">
                <MenuItem Header="Сохранить" Command="{Binding SaveCommand}"/>
                <MenuItem Header="Экспорт в Excel" Command="{Binding ExportCommand}"/>
            </MenuItem>
            <MenuItem Header="Действия">
                <MenuItem Header="Добавить студента" Command="{Binding AddStudentCommand}"/>
                <MenuItem Header="Добавить оценку" Command="{Binding AddGradeCommand}"/>
            </MenuItem>
        </Menu>

        <ToolBar Grid.Row="2">
            <Button Content="Добавить студента" Command="{Binding AddStudentCommand}"/>
            <Button Content="Добавить оценку" Command="{Binding AddGradeCommand}"
                   IsEnabled="{Binding SelectedStudent, Converter={StaticResource NullToBooleanConverter}}"/>
        </ToolBar>

        <GroupBox Grid.Row="3" Header="Добавить нового студента" Margin="5">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Фамилия:" VerticalAlignment="Center" Margin="5"/>
                <TextBox Text="{Binding NewStudentLastName, UpdateSourceTrigger=PropertyChanged}" 
                       Width="200" Margin="5"/>
                <Button Content="Добавить" Command="{Binding AddStudentCommand}" 
                       Margin="5" Padding="10,0"/>
            </StackPanel>
        </GroupBox>

        <ListView Grid.Row="4" ItemsSource="{Binding Students}" 
                 ItemTemplate="{StaticResource StudentTemplate}"
                 SelectedItem="{Binding SelectedStudent}"
                 Margin="5">
            <ListView.InputBindings>
                <KeyBinding Key="Delete" Command="{Binding DeleteGradeCommand}"/>
            </ListView.InputBindings>
        </ListView>

        <StatusBar Grid.Row="5">
            <StatusBarItem>
                <TextBlock Text="{Binding Students.Count, StringFormat='Всего студентов: {0}'}"/>
            </StatusBarItem>
            <StatusBarItem>
                <TextBlock Text="{Binding SelectedStudent.LastName, StringFormat='Выбран: {0}'}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>